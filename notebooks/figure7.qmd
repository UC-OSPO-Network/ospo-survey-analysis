---
title: "Fig 7: Motivations for contributing to OS"
---

# Overview
This notebook is for final tweaks to fig 7, which is from Q6 on motivations.

# Import packages and utilities
```{r}
project_root <- here::here() # requires that you be somewhere in the
# project directory (not above it)
# packages
suppressMessages(source(file.path(project_root, "scripts/packages.R")))
# functions and objects used across scripts
suppressMessages(source(file.path(project_root, "scripts/utils.R")))
```

# Define functions
```{r}
line_plot <- function(df, x_var, y_var, title) {
  p <- ggplot(df, aes(x = .data[[x_var]], y = .data[[y_var]])) +
    geom_point(size = 4) + # Adjust dot size
    scale_y_continuous(labels=scales::percent) +
    labs(
      title = title
    ) +
    theme(
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      axis.text.x = element_text(angle = 60, vjust = 0.6, size = 24),
      axis.text.y = element_text(size = 24),
      axis.ticks.x = element_blank(),
      axis.ticks.y = element_blank(),
      legend.title = element_blank(),
      plot.title = element_text(
        hjust = 0,
        face = "bold",
        size = 24,
        margin = margin(b = 15)
      ),
      plot.margin = unit(c(1, 1, 1, 3), "cm"),
      panel.grid = element_line(linetype = "solid", color = "gray90"),
      panel.background = element_blank()
    )
  return(p)
}
```

# Load data

```{r}
basic_data <- read.csv(
    file.path(
      Sys.getenv("DATA_PATH"),
      "data_for_plots",
      "motivations_basic_bar.tsv"
    ),
    stringsAsFactors = TRUE,
    sep = "\t"
  )

it_acad_data <- read.csv(
    file.path(
      Sys.getenv("DATA_PATH"),
      "data_for_plots",
      "motivations_it_acad.tsv"
    ),
    stringsAsFactors = TRUE,
    sep = "\t"
  )

skills_data <- read.csv(
    file.path(
      Sys.getenv("DATA_PATH"),
      "data_for_plots",
      "motivations_skills.tsv"
    ),
    stringsAsFactors = TRUE,
    sep = "\t"
  )
```

Order factor levels

```{r}
basic_data <- basic_data %>%
  mutate(Motivation = fct_reorder(Motivation, Count, .desc = FALSE))

skills_data$job_category <- factor(skills_data$job_category, 
levels = c(
      "Undergraduate",
      "Grad Student",
      "Post-Doc",
      "Faculty"
    )
)
```


```{r}
basic_plot <- basic_bar_chart(basic_data,
  x_var = "Motivation",
  y_var = "Count",
  title = "Reasons for Contributing to Open Source",
  horizontal = TRUE,
  show_bar_labels = TRUE,
  show_ticks_y = FALSE,
  color_index = 3,
  show_axis_title_x = TRUE,
  show_axis_title_y = FALSE,
  show_grid = TRUE,
  margin_vals = c(1, 1, 1, 1)
)

it_acad_job_plot <- basic_bar_chart(it_acad_data,
  x_var = "role",
  y_var = "proportion_yes",
  title = "Percent of Respondents who said\n'Developing open source products\nis part of my job'",
  show_bar_labels = FALSE,
  show_ticks_y = FALSE,
  show_axis_title_y = FALSE,
  show_axis_title_x = FALSE,
  show_grid = TRUE,
  percent = TRUE,
  margin_vals = c(3, 1, 1, 1)
)

skills_plot <- line_plot(skills_data,
x_var = "job_category",
y_var = "Proportion",
title = "Percent of Participants Motivated by\nDesire to Improve Their Skills"
)
```



```{r}
# From the patchwork package
top_row <- basic_plot + plot_spacer() + plot_layout(widths = c(1.5, 0.5))
bottom_row <- skills_plot + it_acad_job_plot + plot_layout(widths = c(1, 1))

fig <- top_row / bottom_row
```

```{r}
svglite::svglite(file.path(FIGURE_PATH, "motivations.svg"), width = 16, height = 16); print(fig); dev.off()
```
