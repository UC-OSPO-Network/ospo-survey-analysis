---
title: "Final Thoughts"
---

# Overview

Plotting results of coding analysis of Q12: "Are there any other challenges youâ€™ve encountered in open source, or types of support that you would find helpful?"

## Import packages and utilities

```{r}
project_root <- here::here() # requires that you be somewhere in the
# project directory (not above it)
# packages
suppressMessages(source(file.path(project_root, "scripts/packages.R")))
# functions and objects used across scripts
suppressMessages(source(file.path(project_root, "scripts/utils.R")))
```

I did this analysis in Taguette. Then I manually copied the number of comments associated with each tag from Taguette to this notebook. Each comment can have multiple tags. I'm creating the dataframe row-wise using tribble because that makes it a little easier to read and change, and I expect these fluid categories might change.
```{r}
results <- tribble(
  ~theme,                                    ~category,       ~count,
  "Maintenance",                                 "Resources",      9,
  "Funding OS projects",                         "Resources",      8,
  "High turnover",                               "Resources",      3,
  "Skilled personnel",                           "Resources",      9,
  "Lack of time or 'extra' work",                "Resources",      7,
  "Security compliance",                         "Infrastructure", 2,
  "Licensing",                                   "Infrastructure", 3,
  "Computing environments",                      "Infrastructure", 4,
  "University leadership, norms, and priorities","Culture",       20,
  "Code review and replication",                 "Culture",        4,
  "OS education and careers",                    "Culture",        8,
  "Value of OS tools",                           "Culture",        7
)

results$theme <- paste0(results$theme, " (", results$count, ")")
```

# Plot a treemap

Now let's plot a treemap! I will use the treemapify package because it integrates nicely with ggplot2.

Reorder factor levels so that categories appear in the order my eye notices them on the plot.

```{r}
results$category <- factor(
  results$category,
  levels = c("Resources", "Culture", "Infrastructure")
)
```

```{r, fig.width=9, fig.height=8}
pal <- c("#1964b0", "#117733", "#71190d")

ggp <- ggplot(
  results,
  aes(
    area = count, # sizes
    fill = category, # colors
    label = theme,
    subgroup = category
  )
) +
  treemapify::geom_treemap() +
  treemapify::geom_treemap_text(
    reflow = TRUE,
    place = "centre",
    grow = FALSE, # cap label font size at 'size'
    size = 20,
    colour = "white"
  ) +
  labs(title = "Comments on challenges and solutions") +
  scale_fill_manual(values = pal, guide = guide_legend(title = "Category")) +
  theme(
    legend.text = element_text(size = 20),
    legend.title = element_blank(),
    panel.background = element_blank(),
    plot.margin = margin(1, 1, 1, 1, unit = "cm"),
    plot.title = element_text(size = 24, hjust = 0, face = "bold")
  )

ggp
```

Save the plot
```{r}
save_plot("treemap.tiff", 12, 9, p=ggp)
```

Let's do that again, but with smaller font sizes according to PLOS submission guidelines.
```{r}
ggp <- ggplot(
  results,
  aes(
    area = count, # sizes
    fill = category, # colors
    label = theme,
    subgroup = category
  )
) +
  treemapify::geom_treemap() +
  treemapify::geom_treemap_text(
    reflow = TRUE,
    place = "centre",
    grow = FALSE, # cap label font size at 'size'
    size = 10,
    colour = "white"
  ) +
  labs(title = "Comments on challenges and solutions") +
  scale_fill_manual(values = pal, guide = guide_legend(title = "Category")) +
  theme(
    legend.text = element_text(size = 10),
    legend.title = element_blank(),
    panel.background = element_blank(),
    plot.margin = margin(1, 1, 1, 1, unit = "cm"),
    plot.title = element_text(size = 10, hjust = 0, face = "bold")
  )
```

```{r}
ggsave(
  filename = file.path(FIGURE_PATH, "Fig10.tif"),
  plot = ggp,
  device = "tiff",
  width = 7.5, height = 4, units = "in",
  dpi = 300,                
  compression = "none",    
  bg = "white"
)
```

```{r}
sessionInfo()
```